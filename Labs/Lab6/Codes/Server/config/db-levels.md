–ú—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–ª–æ–Ω–∫—É `level` –≤ —Ç–∞–±–ª–∏—Ü–µ `users`, —á—Ç–æ–±—ã —Ö—Ä–∞–Ω–∏—Ç—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —É—Ä–æ–≤–Ω—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —É—Ä–æ–≤–Ω–µ–π

–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã:

```sql
CREATE TABLE user_levels (
    id SERIAL PRIMARY KEY,
    level_name VARCHAR(50) NOT NULL,
    description TEXT NOT NULL
);
```

### 2. –í—Å—Ç–∞–≤–∫–∞ —É—Ä–æ–≤–Ω–µ–π

–°–æ–∑–¥–∞—Ç—å —É—Ä–æ–≤–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∏—Ö –æ–ø–∏—Å–∞–Ω–∏—è–º–∏:

```sql
INSERT INTO user_levels (level_name, description) VALUES
('VIP', '–î–ª—è —Å–∞–º—ã—Ö –ø—Ä–µ–¥–∞–Ω–Ω—ã—Ö –∑—Ä–∏—Ç–µ–ª–µ–π! üåü'),
('–ö–∏–Ω–æ–º–∞–≥–Ω–∞—Ç', '–î–ª—è —Ç–µ—Ö, –∫—Ç–æ –∏–Ω–≤–µ—Å—Ç–∏—Ä—É–µ—Ç –≤ —Å–≤–æ–∏ —É–≤–ª–µ—á–µ–Ω–∏—è! üí∞'),
('–ö–∏–Ω–æ–∑–Ω–∞—Ç–æ–∫', '–ó–∞ –∞–∫—Ç–∏–≤–Ω–æ–µ —É—á–∞—Å—Ç–∏–µ –∏ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø–æ–∫—É–ø–æ–∫! üéüÔ∏è'),
('–ö–∏–Ω–æ—ç–Ω—Ç—É–∑–∏–∞—Å—Ç', '–î–ª—è —Ç–µ—Ö, –∫—Ç–æ –ª—é–±–∏—Ç –ø–æ—Å–µ—â–∞—Ç—å –ø–æ–∫–∞–∑—ã –∏ –∫–æ–Ω—Ü–µ—Ä—Ç—ã! üéâ'),
('–ö–∏–Ω–æ–ª—é–±–∏—Ç–µ–ª—å', '–ó–∞ –ø–µ—Ä–≤—É—é –ø–æ–∫—É–ø–∫—É –±–∏–ª–µ—Ç–∞ –∏–ª–∏ –ø–æ–¥–ø–∏—Å–∫–∏! üçø');
```

### 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏ `level` –≤ —Ç–∞–±–ª–∏—Ü—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞ `users`, –¥–æ–±–∞–≤–∏–º –∫–æ–ª–æ–Ω–∫—É `level`:

```sql
ALTER TABLE users ADD COLUMN level INT;
```

### 4. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —É—Ä–æ–≤–Ω—è–º–∏

–¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–¥–∏–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —É—Ä–æ–≤–Ω—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

#### 4.1. –ü–æ–ª—É—á–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –µ–≥–æ ID:

```sql
CREATE FUNCTION get_user_level(user_id INT)
RETURNS VARCHAR(255)
BEGIN
    DECLARE userLevel VARCHAR(255);
    SELECT CONCAT(level_name, ': ', description) INTO userLevel
    FROM user_levels
    WHERE id = (SELECT level FROM users WHERE id = user_id);
    RETURN userLevel;
END;
```

#### 4.2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —É—Ä–æ–≤–Ω—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```sql
CREATE PROCEDURE set_user_level(user_id INT, level_name VARCHAR(50))
BEGIN
    DECLARE levelId INT;
    
    SELECT id INTO levelId
    FROM user_levels
    WHERE level_name = level_name;
    
    IF levelId IS NOT NULL THEN
        UPDATE users SET level = levelId WHERE id = user_id;
    ELSE
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = '–£—Ä–æ–≤–µ–Ω—å –Ω–µ –Ω–∞–π–¥–µ–Ω';
    END IF;
END;
```

#### 4.3. –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∏—Ö —É—Ä–æ–≤–Ω—è–º–∏

–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∏—Ö —É—Ä–æ–≤–Ω—è–º–∏:

```sql
CREATE OR REPLACE FUNCTION get_all_users_with_levels()
RETURNS TABLE (user_id INT, username VARCHAR(255), level_name VARCHAR(50), description TEXT) AS $$
BEGIN
    RETURN QUERY (
        SELECT u.id, u.username, ul.level_name, ul.description
        FROM users u
        LEFT JOIN user_levels ul ON u.level = ul.id
    );
END;
$$ LANGUAGE plpgsql;


SELECT * FROM get_all_users_with_levels();
```

### 5. –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π

–¢–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

- **–ü–æ–ª—É—á–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å ID 1**:

```sql
SELECT get_user_level(1);
```

- **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å "–ö–∏–Ω–æ–º–∞–≥–Ω–∞—Ç" –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å ID 2**:

```sql
CALL set_user_level(2, '–ö–∏–Ω–æ–º–∞–≥–Ω–∞—Ç');
```

- **–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∏—Ö —É—Ä–æ–≤–Ω—è–º–∏**:

```sql
SELECT * FROM get_all_users_with_levels();
```